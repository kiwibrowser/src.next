# Copyright 2014 The Chromium Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

static_library("browser") {
  sources = [
    "browsing_history_driver.h",
    "browsing_history_service.cc",
    "browsing_history_service.h",
    "domain_mixing_metrics.cc",
    "domain_mixing_metrics.h",
    "download_constants.h",
    "download_database.cc",
    "download_database.h",
    "download_row.cc",
    "download_row.h",
    "download_slice_info.cc",
    "download_slice_info.h",
    "download_types.cc",
    "download_types.h",
    "expire_history_backend.cc",
    "expire_history_backend.h",
    "features.cc",
    "features.h",
    "history_backend.cc",
    "history_backend.h",
    "history_backend_client.h",
    "history_backend_notifier.h",
    "history_backend_observer.h",
    "history_client.h",
    "history_constants.cc",
    "history_constants.h",
    "history_context.h",
    "history_database.cc",
    "history_database.h",
    "history_database_params.cc",
    "history_database_params.h",
    "history_db_task.h",
    "history_service.cc",
    "history_service.h",
    "history_service_observer.h",
    "history_types.cc",
    "history_types.h",
    "in_memory_database.cc",
    "in_memory_database.h",
    "in_memory_history_backend.cc",
    "in_memory_history_backend.h",
    "keyword_id.h",
    "keyword_search_term.cc",
    "keyword_search_term.h",
    "keyword_search_term_util.cc",
    "keyword_search_term_util.h",
    "page_usage_data.cc",
    "page_usage_data.h",
    "sync/delete_directive_handler.cc",
    "sync/delete_directive_handler.h",
    "sync/history_backend_for_sync.h",
    "sync/history_delete_directives_model_type_controller.cc",
    "sync/history_delete_directives_model_type_controller.h",
    "sync/history_model_type_controller.cc",
    "sync/history_model_type_controller.h",
    "sync/history_model_type_controller_helper.cc",
    "sync/history_model_type_controller_helper.h",
    "sync/history_sync_bridge.cc",
    "sync/history_sync_bridge.h",
    "sync/history_sync_metadata_database.cc",
    "sync/history_sync_metadata_database.h",
    "sync/typed_url_sync_bridge.cc",
    "sync/typed_url_sync_bridge.h",
    "sync/typed_url_sync_metadata_database.cc",
    "sync/typed_url_sync_metadata_database.h",
    "sync/visit_id_remapper.cc",
    "sync/visit_id_remapper.h",
    "top_sites.cc",
    "top_sites.h",
    "top_sites_backend.cc",
    "top_sites_backend.h",
    "top_sites_database.cc",
    "top_sites_database.h",
    "top_sites_impl.cc",
    "top_sites_impl.h",
    "top_sites_observer.h",
    "url_database.cc",
    "url_database.h",
    "url_row.cc",
    "url_row.h",
    "url_utils.cc",
    "url_utils.h",
    "visit_annotations_database.cc",
    "visit_annotations_database.h",
    "visit_database.cc",
    "visit_database.h",
    "visit_delegate.cc",
    "visit_delegate.h",
    "visit_tracker.cc",
    "visit_tracker.h",
    "visitsegment_database.cc",
    "visitsegment_database.h",
    "web_history_service.cc",
    "web_history_service.h",
    "web_history_service_observer.h",
  ]

  public_deps = [
    "//components/sessions:session_id",
    "//components/sync/protocol",
    "//skia",
  ]

  deps = [
    "//base",
    "//base:i18n",
    "//components/database_utils",
    "//components/favicon/core:database",
    "//components/favicon_base",
    "//components/google/core/common",
    "//components/history/core/common",
    "//components/keyed_service/core",
    "//components/prefs",
    "//components/query_parser",
    "//components/search_engines",
    "//components/signin/public/identity_manager",
    "//components/sync",
    "//components/url_formatter",
    "//components/variations",
    "//components/version_info",
    "//google_apis",
    "//net",
    "//services/network/public/cpp",
    "//sql",
    "//third_party/sqlite",
    "//ui/base",
    "//ui/gfx",
    "//url",
  ]

  if (is_android) {
    sources += [
      "android/android_cache_database.cc",
      "android/android_cache_database.h",
      "android/android_history_types.cc",
      "android/android_history_types.h",
      "android/android_time.h",
      "android/android_urls_database.cc",
      "android/android_urls_database.h",
      "android/android_urls_sql_handler.cc",
      "android/android_urls_sql_handler.h",
      "android/favicon_sql_handler.cc",
      "android/favicon_sql_handler.h",
      "android/sql_handler.cc",
      "android/sql_handler.h",
      "android/urls_sql_handler.cc",
      "android/urls_sql_handler.h",
      "android/visit_sql_handler.cc",
      "android/visit_sql_handler.h",
    ]
  }
}

bundle_data("unit_tests_bundle_data") {
  visibility = [ ":unit_tests" ]
  testonly = true
  sources = [
    "//components/test/data/history/Favicons.v3.sql",
    "//components/test/data/history/Favicons.v4.sql",
    "//components/test/data/history/Favicons.v5.sql",
    "//components/test/data/history/Favicons.v6.sql",
    "//components/test/data/history/Favicons.v7.sql",
    "//components/test/data/history/Favicons.v8.sql",
    "//components/test/data/history/HistoryNoDuration",
    "//components/test/data/history/HistoryNoSource",
    "//components/test/data/history/History_with_starred",
    "//components/test/data/history/TopSites.v1.sql",
    "//components/test/data/history/TopSites.v2.sql",
    "//components/test/data/history/TopSites.v3.sql",
    "//components/test/data/history/TopSites.v4.sql",
    "//components/test/data/history/history.22.sql",
    "//components/test/data/history/history.26.sql",
    "//components/test/data/history/history.27.sql",
    "//components/test/data/history/history.28.sql",
    "//components/test/data/history/history.29.sql",
    "//components/test/data/history/history.30.sql",
    "//components/test/data/history/history.31.sql",
    "//components/test/data/history/history.32.sql",
    "//components/test/data/history/history.38.sql",
    "//components/test/data/history/history.39.sql",
    "//components/test/data/history/history.40.sql",
    "//components/test/data/history/history.41.sql",
    "//components/test/data/history/history.42.sql",
    "//components/test/data/history/history.43.sql",
    "//components/test/data/history/history.44.sql",
    "//components/test/data/history/history.45.sql",
    "//components/test/data/history/history.46.sql",
    "//components/test/data/history/history.47.sql",
    "//components/test/data/history/history.48.sql",
    "//components/test/data/history/history.49.sql",
    "//components/test/data/history/history.50.sql",
    "//components/test/data/history/history.52.sql",
    "//components/test/data/history/history.53.sql",
    "//components/test/data/history/history.54.sql",
    "//components/test/data/history/history.55.sql",
    "//components/test/data/history/history.56.sql",
    "//components/test/data/history/history.57.sql",
    "//components/test/data/history/history.58.sql",
    "//components/test/data/history/history.59.sql",
    "//components/test/data/history/thumbnail_wild/Favicons.corrupt_meta.disable",
    "//components/test/data/history/thumbnail_wild/Favicons.v2.init.sql",
    "//components/test/data/history/thumbnail_wild/Favicons.v3.init.sql",
    "//components/test/data/history/thumbnail_wild/Favicons.v4.init.sql",
    "//components/test/data/history/thumbnail_wild/Favicons.v5.icon_type.sql",
    "//components/test/data/history/thumbnail_wild/Favicons.v5.icon_type2.sql",
    "//components/test/data/history/thumbnail_wild/Favicons.v5.init.sql",
    "//components/test/data/history/thumbnail_wild/Favicons.v5.sizes.sql",
    "//components/test/data/history/thumbnail_wild/Favicons.v6.init.sql",
  ]
  outputs = [ "{{bundle_resources_dir}}/" +
              "{{source_root_relative_dir}}/{{source_file_part}}" ]
}

source_set("unit_tests") {
  testonly = true
  sources = [
    "browsing_history_service_unittest.cc",
    "domain_mixing_metrics_unittest.cc",
    "download_slice_info_unittest.cc",
    "expire_history_backend_unittest.cc",
    "history_backend_db_unittest.cc",
    "history_backend_unittest.cc",
    "history_database_unittest.cc",
    "history_querying_unittest.cc",
    "history_service_unittest.cc",
    "history_types_unittest.cc",
    "sync/delete_directive_handler_unittest.cc",
    "sync/history_sync_bridge_unittest.cc",
    "sync/history_sync_metadata_database_unittest.cc",
    "sync/test_history_backend_for_sync.cc",
    "sync/test_history_backend_for_sync.h",
    "sync/typed_url_sync_bridge_unittest.cc",
    "sync/typed_url_sync_metadata_database_unittest.cc",
    "sync/visit_id_remapper_unittest.cc",
    "top_sites_database_unittest.cc",
    "top_sites_impl_unittest.cc",
    "url_database_unittest.cc",
    "url_row_unittest.cc",
    "url_utils_unittest.cc",
    "visit_annotations_database_unittest.cc",
    "visit_database_unittest.cc",
    "visit_tracker_unittest.cc",
    "web_history_service_unittest.cc",
  ]
  deps = [
    ":browser",
    ":unit_tests_bundle_data",
    "//base",
    "//base/test:test_support",
    "//components/enterprise/common:download_item_reroute_info",
    "//components/favicon/core:database",
    "//components/favicon_base",
    "//components/history/core/common",
    "//components/history/core/test",
    "//components/prefs:test_support",
    "//components/search_engines",
    "//components/sync:test_support",
    "//net:test_support",
    "//services/network:test_support",
    "//services/network/public/cpp",
    "//sql",
    "//sql:test_support",
    "//testing/gtest",
    "//third_party/sqlite",
    "//ui/gfx",
    "//ui/gfx:test_support",
    "//url",
  ]
  if (is_android) {
    sources += [ "android/android_history_types_unittest.cc" ]
  }
}
